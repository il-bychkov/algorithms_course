# Практическое занятие
## Разбор арифметических выражений (стековые машины)

**Задача**: разбор и вычисление арифметического выражения, представленного в виде строки.

**Допустимые символы**: основные бинарные операторы +, -, *, /; скобки (), цифры 0-9.

Существует несколько форм представления арифметических вырыжений, например:

**Инфиксная форма** - самая распространнёная форма, так как человека она проще для представления.
Выражение, в котором операторы располагаются между операндами.

Пример: 2 + 2 = 4

**Префиксная форма** - выражение, в котором операторы находятся перед операндами.

Пример: + 2 2 = 4

**Постфиксная форма** - выражение, в котором оператор находится после операндов.

Пример: 2 2 + = 4

Для вычисления выражения, записанного в инфиксной формы, необходимо его предварительно проанализировать с учётом старшинства операторов и скобок.
В свою очередь, префиксная и постфиксная формы такого не требуют, так как операторы записываются в порядке их вычисления и без скобок.

Префиксная форма называется польской записью, а постфиксная - обратной польской записью (reversed polish notation - RPN).


Выражения, записанные в префиксном или постфиксном виде, также называют бесскобочной или польской записью.
Их называют польскими в честь автора - польского математика Ян Лукасевича.

Для решения изначальной задачи потребуется два шага:
1. Преобразование из инфиксной формы в постфиксную
2. Последовательное вычисление выражения по постфиксной форме


Чтобы преобразовать строку-выражение из инфиксной формы в постфиксную используется алгоритм, предложенный Эдсгером Вибе Дейкстрой.
Этот алгоритм называется **алгоритм сортировочной станции (shunting yard algorithm)**.

Данный алгоритм хранит результирующую строку с постфиксной записью (изначально пустую) и стек операторов.

**Основные идеи алгоритма сортировочной станции:**

- Проходим исходную строку

- При нахождении числа, заносим его в выходную строку

- При нахождении оператора, заносим его в стек

- Выталкиваем в выходную строку из стека все операторы, имеющие приоритет выше рассматриваемого

- При нахождении открывающейся скобки, заносим её в стек

- При нахождении закрывающей скобки, выталкиваем из стека все операторы до открывающейся скобки, а открывающуюся скобку удаляем из стека


**Определим операции и их приоритеты:**

Приоритеты:\
высокий: выражения, заключённые в скобки ( )\
средний: * /\
низкий: + −\

**Пример работы алгоритма:**

**Вход:** 3 + 4 * 2 / (1 - 5)

Читаем «3»\
 Добавим «3» к выходной строке\
  Выход: 3

Читаем «+»\
 Кладём «+» в стек\
  Выход: 3\
  Стек: +

Читаем «4»\
 Добавим «4» к выходной строке\
  Выход: 3 4\
  Стек: +

Читаем «*»\
 Кладём «*» в стек\
  Выход: 3 4\
  Стек: + *

Читаем «2»\
 Добавим «2» к выходной строке\
  Выход: 3 4 2\
  Стек: + *

Читаем «/»\
 Выталкиваем «*» из стека в выходную строку, кладём «/» в стек\
  Выход: 3 4 2 *\
  Стек: + /

Читаем «(»\
 Кладём «(» в стек\
  Выход: 3 4 2 *\
  Стек: + / (

Читаем «1»\
 Добавим «1» к выходной строке\
  Выход: 3 4 2 * 1\
  Стек: + / (

Читаем «−»\
 Кладём «−» в стек\
  Выход: 3 4 2 * 1\
  Стек: + / ( −

Читаем «5»\
 Добавим «5» к выходной строке\
  Выход: 3 4 2 * 1 5\
  Стек: + / ( -

Читаем «)»\
 Выталкиваем «−» из стека в выходную строку, выталкиваем «(»\
  Выход: 3 4 2 * 1 5 −\
  Стек: + /

Конец выражения\
 Выталкиваем все элементы из стека в строку\
  Выход: 3 4 2 * 1 5 − 2 ^ / +

После того как постфиксная форма выражения сформирована, выражение может быть вычислено простым алгоритмом:
- Последовательно сканируем элементы из очереди с постфиксной записью
- Если текущий элемент - операнд (число) - складываем его в стек
- Если текущий элемент - оператор - вынимаем из стека нужное число операндов, выполняем оператор и результат возвращаем в стек

По мотивам статей:\
https://habr.com/ru/articles/596925/ - Польская нотация или как легко распарсить алгебраическое выражение, Habr\
https://ru.wikipedia.org/wiki/Обратная_польская_запись - Обратная польская запись, Wiki\
